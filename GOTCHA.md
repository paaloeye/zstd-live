# GOTCHA.md

Common gotchas and pitfalls when working [Claude Code](https://claude.ai/code) in AI-aided fashion.

This file provides guidance to Claude when it keeps making the same mistakes.

## 🐚 Shell Compatibility in GitHub Actions

### Issue
GitHub Actions workflows that use bash-specific syntax (like `[[`, `==`, pattern matching) will fail when executed with `/bin/sh`.

### Symptoms
```
/bin/sh: [[: not found
```

### Example Problem
```yaml
# ❌ Bash-specific syntax in workflow
if [[ $VERSION == *"-"* ]]; then
  echo "prerelease=true" >> $GITHUB_OUTPUT
fi
```

### Solution
Use POSIX-compliant shell syntax in GitHub Actions:
```yaml
# ✅ POSIX-compliant
case "$VERSION" in
  *-*) echo "prerelease=true" >> $GITHUB_OUTPUT ;;
  *) echo "prerelease=false" >> $GITHUB_OUTPUT ;;
esac
```

### Why This Happens
- GitHub Actions uses `/bin/sh` by default, not bash
- `[[` is a bash builtin not available in POSIX sh

### Prevention
- Always use POSIX shell syntax in GitHub Actions workflows
- Use `case` statements instead of `[[ == ]]` pattern matching
- Test workflows locally with `sh -c "command"`

## 📋 Incomplete Release Notes in ship.yml

### Issue
Release notes generated by GitHub Actions lack comprehensive information about supported platforms, installation instructions, and user guidance.

### Symptoms
- Minimal release notes with only changelog
- Users don't know which binary to download
- Missing installation instructions
- No security information (checksums)

### Example Problem
```yaml
# ❌ Minimal release notes
echo "## Changes" > release_notes.md
git log --pretty=format:"- %s" $PREV_TAG..HEAD >> release_notes.md
```

### Solution
**Skip adding comprehensive release notes** - Keep ship.yml focused on core functionality only.

### Why This Happens
- Temptation to over-engineer release automation
- Adding complexity where simplicity is preferred
- Focus should be on working releases, not elaborate documentation

### Prevention
- Resist urge to add comprehensive platform documentation to ship.yml
- Keep release workflows simple and focused
- Use README.md and documentation sites for user guidance instead
- Prioritise working releases over elaborate release notes

<!-- gotcha template -->
## Issue %%something%%

### Issue

TBC

### Symptoms

TBC

### Example Problem

TBC

### Solution

TBC

### Why This Happens

TBC

### Prevention

TBC
